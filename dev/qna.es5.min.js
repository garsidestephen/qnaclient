"use strict";var qnaClient=function(){function st(){var t=function(){it()};v(n.botPrimingPhrase,1,t)}function ht(){u.fadeIn(s);l()}function it(){f.fadeIn(s)}function ct(){u.fadeOut(s)}function lt(){f.fadeOut(s)}function at(){if(n.unansweredQuestionsEndpoint!=null&&n.unansweredQuestionsEndpoint.match(/(http(s?))\:\/\//gi)){var t=c.join(" | ");$.post(n.unansweredQuestionsEndpoint,{UnansweredQuestion:t})}}function vt(){c=[]}function yt(){f.on("click",function(){lt();ht()});k.on("click",function(){ct();it();at();vt()});r.on("keydown",function(n){bt(n)});u.on("click",".js-qna-chip-click",function(){pt($(this))})}function pt(n){var t=n.data("chip-value");t.length&&v(t,1)}function wt(n){var t=h.height(),i=e.height(),r=t<i?i+20:t+20;o.height(r);o.fadeIn("fast",function(){n&&n()})}function rt(n){o.fadeOut("fast",function(){n&&n()})}function bt(n){return n.which==13?(kt(),!1):n.which==38?(ut(38),!1):n.which==40?(ut(40),!1):void 0}function kt(){var n=r.val();n!=null&&n.length>0&&(i.push(n),t=i.length+1,y(n),v(n))}function ut(n){i.length>0&&(n==38?t=t<0?0:t-=1:n==40&&(t=t>i.length?i.length:t+=1),r.val(i[t-1]))}function l(){r.val("");r.focus()}function dt(t){t&&(t.minimumAcceptableAnswerScore!=null?n.minimumAcceptableAnswerScore=t.minimumAcceptableAnswerScore:n.minimumAcceptableAnswerScore,t.theme!=null?n.theme=t.theme:n.theme,t.title!=null?n.title=t.title:n.title,t.pageContainerId!=null?n.pageContainerId=t.pageContainerId:n.pageContainerId,t.pageContainerClass!=null?n.pageContainerClass=t.pageContainerClass:n.pageContainerClass,t.noAnswerPhrase!=null?n.noAnswerPhrase=t.noAnswerPhrase:n.noAnswerPhrase,t.somethingGoneWrongPhrase!=null?n.somethingGoneWrongPhrase=t.somethingGoneWrongPhrase:n.somethingGoneWrongPhrase,t.displayImagesInline!=null?n.displayImagesInline=t.displayImagesInline:n.displayImagesInline,t.loggingEnabled!=null?n.loggingEnabled=t.loggingEnabled:n.loggingEnabled,t.botPrimingPhrase!=null?n.botPrimingPhrase=t.botPrimingPhrase:n.botPrimingPhrase,t.buttonToolTip!=null?n.buttonToolTip=t.buttonToolTip:n.buttonToolTip,t.inputPrompt!=null?n.inputPrompt=t.inputPrompt:n.inputPrompt,t.position!=null?n.position=t.position:n.position,t.logoUrl!=null?n.logoUrl=t.logoUrl:n.logoUrl,t.busyMessage!=null?n.busyMessage=t.busyMessage:n.busyMessage,t.unansweredQuestionsEndpoint!=null?n.unansweredQuestionsEndpoint=t.unansweredQuestionsEndpoint:n.unansweredQuestionsEndpoint)}function a(t){n.loggingEnabled===!0&&console.log(t)}function gt(t){$.get("/qna/qna.html",function(i){p=$("body");$domLocation=n.pageContainerId!=null&&n.pageContainerId!=""?$("#"+n.pageContainerId):n.pageContainerClass!=null&&n.pageContainerClass!=""?$("."+n.pageContainerClass):p;$domLocation.append(i);ni();t&&t()})}function ni(){h=$(".js-qna-bot__stream-wrap__stream");e=$(".js-qna-bot__stream-wrap");u=$(".js-qna");et=$(".js-qna-bot");o=$(".js-qna-bot__stream-wrap__busy");w=$(".js-qna-bot__header__title");b=$(".js-qna-bot__header__logo");k=$(".js-qna-bot__header__close");r=$(".js-qna-bot__input__text");f=$(".js-qna-launcher");d=$(".js-qna-launcher__button__image");g=$(".js-qna-bot__stream-wrap__busy__wrap__message")}function ti(){w.text(n.title);b.attr("src",n.logoUrl);d.attr("title",n.buttonToolTip);r.attr("placeholder",n.inputPrompt);g.text(n.busyMessage)}function v(n,t,i){if(n!=null&&n!=""){var r=t==null||t==0?1:t;wt();$.ajax({type:"POST",url:tt,beforeSend:function(n){n.setRequestHeader("Ocp-Apim-Subscription-Key",nt)},contentType:"application/json",data:JSON.stringify({question:n,top:r}),success:function(t){ii(t,n,i)},error:function(n,t,r){fi(n,t,r,i)}})}}function ii(t,i,r){var u,f,e,o,s,h,v;rt();u="";t!=null&&t.answers!=null&&t.answers.length>0?(f=t.answers[0],f.score>n.minimumAcceptableAnswerScore?(u=f.answer,e=u.match(/\[(.*?)\]\((.*?)\)/g),e&&(u=ri(u,e)),o=u.match(/\##chips(.*?)##/g),s="",o&&(s=ui(u,o[0]),u=u.replace(/##chips(.*?)##/g,""))):(u=n.noAnswerPhrase,c.push(i)),a("Top Answer: "+f.answer+" | Score: "+f.score)):u=n.somethingGoneWrongPhrase;l();h=si(new Date);v="<div style='display:flex;justify-content: flex-end;align-items: center;margin-bottom:10px;'><p class='qna-bot__stream-wrap__stream__interaction__speech'>"+u+"<span class='qna-bot__stream-wrap__stream__date-time'>"+h+"<\/span><\/p><div class='qna-bot__stream-wrap__stream__interaction__arrow-right'><\/div><\/div>"+s;y(v,!0);r&&r()}function ri(t,i){for(var f=0;f<i.length;f++){var o=i[f].split("]("),u=o[0].replace(/\[|\]/g,""),r=o[1].replace(/\(|\)/g,""),e=n.displayImagesInline?"":"<br/>";u.length&&r.length&&(r.match(/\.(gif|jpg|jpeg|tiff|png)$/i)?(t=t.replace("["+u+"]",""),t=t.replace("("+r+")",e+"<img src='"+r+"' alt='"+u+"' class='qna-bot__stream-wrap__stream__interaction__speech__media-asset'/>"+e)):r.match(/(https?\:\/\/)?(www\.youtube\.com|youtu\.?be)\/embed\/.+/i)?(t=t.replace("["+u+"]",""+u),t=t.replace("("+r+")",e+"<iframe width='300' height='170' src='"+r+"' frameborder='0' class='qna-bot__stream-wrap__stream__interaction__speech__media-asset' allow='autoplay; encrypted-media' allowfullscreen><\/iframe>"+e)):(t=t.replace("["+u+"]",""),t=t.replace("("+r+")","<a href='"+r+"'>"+u+"<\/a>")))}return t}function ui(n,t){var u,n,i;for(t=t.replace(/##chips\[|\]##/g,""),u=t.split("]["),n="<div class='qna-chips'>",i=0;i<u.length;i++){var r=u[i].split("|"),f=r[0],e=r[1]==null?r[0]:r[1];f.length&&(n=n+"<span class='qna-chips__chip js-qna-chip-click' data-chip-value='"+e+"'>"+f+"<\/span>")}return n+"<\/div>"}function fi(t,i){a(i);l();y(n.somethingGoneWrongPhrase,!0);rt()}function y(n,t){var i="";i=t?"<div class='qna-bot__stream-wrap__stream__interaction qna-bot__stream-wrap__stream__interaction--from-bot'>"+n+"<\/div>":"<div class='qna-bot__stream-wrap__stream__interaction qna-bot__stream-wrap__stream__interaction--from-user'><div class='qna-bot__stream-wrap__stream__interaction__arrow-left'><\/div><p class='qna-bot__stream-wrap__stream__interaction__speech'>"+n+"<\/p><\/div>";h.append(i);ei()}function ei(){window.setTimeout(function(){e.scrollTop(e[0].scrollHeight)},0)}function oi(){var t="qna-theme--"+n.theme,i="qna-position--"+n.position;u.addClass(t).addClass(i);f.addClass(t).addClass(i)}function si(n){var t=n.getHours(),i=n.getMinutes(),r=t>=12?"pm":"am";return t=t%12,t=t?t:12,i=i<10?"0"+i:i,t+":"+i+" "+r}var ft=!1,hi=/Mobi/.test(navigator.userAgent),ci=$(window).height(),li=$(document).height(),p=null,h=null,e=null,u=null,et=null,r=null,o=null,w=null,b=null,k=null,f=null,d=null,g=null,s="fast",ai=window.location.href.replace(window.location.origin,""),nt=null,tt=null,i=[],t=0,c=[],n={title:"",minimumAcceptableAnswerScore:50,pageContainerId:"",pageContainerClass:"",theme:"default",noAnswerPhrase:"Sorry, I don't understand.",somethingGoneWrongPhrase:"Mmm, something went wrong there, try me again!",loggingEnabled:!0,displayImagesInline:!1,botPrimingPhrase:"Hi",logoUrl:"/qna/logo.png",buttonToolTip:"Start a chat",position:"bottom-left",inputPrompt:"What would you like to say?",busyMessage:"Hold on a mo...",unansweredQuestionsEndpoint:""},ot=function(n,t,i){if(n==null||n==""||t==null||t=="")a("Missing OCPApimSubscriptionKey or UrlKey");else{nt=n;tt="https://westus.api.cognitive.microsoft.com/qnamaker/v2.0/knowledgebases/"+t+"/generateAnswer";ft=window.hasOwnProperty("webkitSpeechRecognition")||window.hasOwnProperty("SpeechRecognition");dt(i);var r=function(){oi();yt();ti();st()};gt(r)}};return{Init:function(n,t,i){ot(n,t,i)}}}();