"use strict";var qnaClient=function(){function ot(){var t=function(){nt()};rt(n.botPrimingPhrase,1,t)}function st(){e.fadeIn(s);c()}function nt(){u.fadeIn(s)}function ht(){e.fadeOut(s)}function ct(){u.fadeOut(s)}function lt(){u.on("click",function(){ct();st()});w.on("click",function(){ht();nt()});r.on("keydown",function(n){vt(n)})}function at(n){var t=h.height(),i=f.height(),r=t<i?i+20:t+20;o.height(r);o.fadeIn("fast",function(){n&&n()})}function tt(n){o.fadeOut("fast",function(){n&&n()})}function vt(n){return n.which==13?(yt(),!1):n.which==38?(it(38),!1):n.which==40?(it(40),!1):void 0}function yt(){var n=r.val();n!=null&&n.length>0&&(i.push(n),t=i.length+1,a(n),rt(n))}function it(n){i.length>0&&(n==38?t=t<0?0:t-=1:n==40&&(t=t>i.length?i.length:t+=1),r.val(i[t-1]))}function c(){r.val("");r.focus()}function pt(t){t&&(t.minimumAcceptableAnswerScore!=null?n.minimumAcceptableAnswerScore=t.minimumAcceptableAnswerScore:n.minimumAcceptableAnswerScore,t.theme!=null?n.theme=t.theme:n.theme,t.title!=null?n.title=t.title:n.title,t.botName!=null?n.botName=t.botName:n.botName,t.botImageUrl!=null?n.botImageUrl=t.botImageUrl:n.botImageUrl,t.pageContainerId!=null?n.pageContainerId=t.pageContainerId:n.pageContainerId,t.pageContainerClass!=null?n.pageContainerClass=t.pageContainerClass:n.pageContainerClass,t.noAnswerPhrase!=null?n.noAnswerPhrase=t.noAnswerPhrase:n.noAnswerPhrase,t.somethingGoneWrongPhrase!=null?n.somethingGoneWrongPhrase=t.somethingGoneWrongPhrase:n.somethingGoneWrongPhrase,t.displayImagesInline!=null?n.displayImagesInline=t.displayImagesInline:n.displayImagesInline,t.loggingEnabled!=null?n.loggingEnabled=t.loggingEnabled:n.loggingEnabled,t.botPrimingPhrase!=null?n.botPrimingPhrase=t.botPrimingPhrase:n.botPrimingPhrase,t.buttonToolTip!=null?n.buttonToolTip=t.buttonToolTip:n.buttonToolTip,t.inputPrompt!=null?n.inputPrompt=t.inputPrompt:n.inputPrompt,t.position!=null?n.position=t.position:n.position,t.logoUrl!=null?n.logoUrl=t.logoUrl:n.logoUrl,t.busyMessage!=null?n.busyMessage=t.busyMessage:n.busyMessage)}function l(t){n.loggingEnabled===!0&&console.log(t)}function wt(t){$.get("/qna/qna.html",function(i){v=$("body");$domLocation=n.pageContainerId!=null&&n.pageContainerId!=""?$("#"+n.pageContainerId):n.pageContainerClass!=null&&n.pageContainerClass!=""?$("."+n.pageContainerClass):v;$domLocation.append(i);bt();t&&t()})}function bt(){h=$(".js-qna-bot__stream-wrap__stream");f=$(".js-qna-bot__stream-wrap");e=$(".js-qna");ft=$(".js-qna-bot");o=$(".js-qna-bot__stream-wrap__busy");y=$(".js-qna-bot__header__title");p=$(".js-qna-bot__header__logo");w=$(".js-qna-bot__header__close");r=$(".js-qna-bot__input__text");u=$(".js-qna-launcher");b=$(".js-qna-launcher__button__image");k=$(".js-qna-bot__stream-wrap__busy__wrap__message")}function kt(){y.text(n.title);p.attr("src",n.logoUrl);b.attr("title",n.buttonToolTip);r.attr("placeholder",n.inputPrompt);k.text(n.busyMessage)}function rt(n,t,i){if(n!=null&&n!=""){var r=t==null||t==0?1:t;at();$.ajax({type:"POST",url:g,beforeSend:function(n){n.setRequestHeader("Ocp-Apim-Subscription-Key",d)},contentType:"application/json",data:JSON.stringify({question:n,top:r}),success:function(n){dt(n,i)},error:function(n,t,r){ni(n,t,r,i)}})}}function dt(t,i){var u,r,f;tt();u="";t!=null&&t.answers!=null&&t.answers.length>0?(r=t.answers[0],r.score>n.minimumAcceptableAnswerScore?(f=r.answer.match(/\[(.*?)\]\((.*?)\)/g),u=r.answer,f&&(u=gt(r.answer,f))):u=n.noAnswerPhrase,l("Top Answer: "+r.answer+" | Score: "+r.score)):u=n.somethingGoneWrongPhrase;c();a(u,!0);i&&i()}function gt(t,i){for(var f=0;f<i.length;f++){var o=i[f].split("]("),u=o[0].replace(/\[|\]/g,""),r=o[1].replace(/\(|\)/g,""),e=n.displayImagesInline?"":"<br/>";u.length&&r.length&&(r.match(/\.(gif|jpg|jpeg|tiff|png)$/i)?(t=t.replace("["+u+"]",""),t=t.replace("("+r+")",e+"<img src='"+r+"' alt='"+u+"' class='qna-bot__stream-wrap__stream__interaction__speech__media-asset'/>"+e)):r.match(/(https?\:\/\/)?(www\.youtube\.com|youtu\.?be)\/embed\/.+/i)?(t=t.replace("["+u+"]",""+u),t=t.replace("("+r+")",e+"<iframe width='300' height='170' src='"+r+"' frameborder='0' class='qna-bot__stream-wrap__stream__interaction__speech__media-asset' allow='autoplay; encrypted-media' allowfullscreen><\/iframe>"+e)):(t=t.replace("["+u+"]",""),t=t.replace("("+r+")","<a href='"+r+"'>"+u+"<\/a>")))}return t}function ni(n,t){l(t);c();a("Something went wrong, please ask your question again.",!0);tt()}function a(n,t){var i="",r;t?(r=ri(new Date),i="<div class='qna-bot__stream-wrap__stream__interaction qna-bot__stream-wrap__stream__interaction--from-bot'><p class='qna-bot__stream-wrap__stream__interaction__speech'>"+n+"<span class='qna-bot__stream-wrap__stream__date-time'>"+r+"<\/span><\/p><div class='qna-bot__stream-wrap__stream__interaction__arrow-right'><\/div><\/div>"):i="<div class='qna-bot__stream-wrap__stream__interaction qna-bot__stream-wrap__stream__interaction--from-user'><div class='qna-bot__stream-wrap__stream__interaction__arrow-left'><\/div><p class='qna-bot__stream-wrap__stream__interaction__speech'>"+n+"<\/p><\/div>";h.append(i);ti()}function ti(){window.setTimeout(function(){f.scrollTop(f[0].scrollHeight)},0)}function ii(){var t="qna-theme--"+n.theme,i="qna-position--"+n.position;e.addClass(t).addClass(i);u.addClass(t).addClass(i)}function ri(n){var t=n.getHours(),i=n.getMinutes(),u=t>=12?"pm":"am",r;return t=t%12,t=t?t:12,i=i<10?"0"+i:i,r=t+":"+i+" "+u,n.getDate()+"/"+n.getMonth()+1+"/"+n.getFullYear()+"  "+r}var ut=!1,ui=/Mobi/.test(navigator.userAgent),fi=$(window).height(),ei=$(document).height(),v=null,h=null,f=null,e=null,ft=null,r=null,o=null,y=null,p=null,w=null,u=null,b=null,k=null,s="fast",oi=window.location.href.replace(window.location.origin,""),d=null,g=null,i=[],t=0,n={title:"",minimumAcceptableAnswerScore:50,botName:"QNA Bot",botImageUrl:"",pageContainerId:"",pageContainerClass:"",theme:"default",noAnswerPhrase:"Sorry, I don't understand.",somethingGoneWrongPhrase:"Mmm, something went wrong there, try me again!",loggingEnabled:!0,displayImagesInline:!1,botPrimingPhrase:"Hi",logoUrl:"/qna/logo.png",buttonToolTip:"Start a chat",position:"bottom-left",inputPrompt:"What would you like to say?",busyMessage:"Hold on a mo..."},et=function(n,t,i){if(n==null||n==""||t==null||t=="")l("Missing OCPApimSubscriptionKey or UrlKey");else{d=n;g="https://westus.api.cognitive.microsoft.com/qnamaker/v2.0/knowledgebases/"+t+"/generateAnswer";ut=window.hasOwnProperty("webkitSpeechRecognition")||window.hasOwnProperty("SpeechRecognition");pt(i);var r=function(){ii();lt();kt();ot()};wt(r)}};return{Init:function(n,t,i){et(n,t,i)}}}();