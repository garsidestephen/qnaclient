var vooi = function () { function e() { F("speechRecognitionService.startVui"), h(), X = !0, Y = !1, f() } function n() { H === !1 && K === !1 && (re.hide(), ce.fadeIn()) } function t() { ce.fadeOut() } function i() { se.hide(), re.fadeIn() } function o() { return 1 == ve.desktopOnly ? $(window).width() > 960 : !0 } function c(e) { if (e && e.length > 0) { var n = 150 * e.length; ue.html(a(e)), se.fadeIn(), setTimeout(function () { se.fadeOut() }, n) } } function a(e) { return m(e) || k(e), e } function r() { re.addClass("vui-awake") } function s() { re.removeClass("vui-awake") } function l() { $("#vui-not-now").on("click", function () { d() }), $("#vui-enable").on("click", function () { u(), t(), i(), e() }), $("#vui-show-more-info").on("click", function () { ae.slideToggle() }), de.on("click", function () { confirm("Do you want to close Vooi?") && (d(), re.fadeOut(), we()) }) } function u() { L(G, !0, 365), "true" == U(N) && (alert("Thank you for enabling Voo-i but we notice you have previously blocked access to the microphone for this website so you will need to re-enable it before Voo-i will work"), M(N)) } function d() { L(J, !0, ve.vuiCTADismissalPeriodInDays), M(G), t() } function h() { null == _ && (_ = new webkitSpeechRecognition, _.lang = "en-GB", _.continuous = !1, _.interimResults = !1, _.onstart = function () { P() }, _.onend = function () { D() }, _.onresult = function (e) { E(e) }, _.onerror = function (e) { A(e) }) } function f() { Z === !1 && (F("startRecognition"), Y = !1, _.start()) } function p() { Z = !0, de.removeClass("vui-not-recognising") } function v() { F("recognitionEnded"), Z = !1, de.addClass("vui-not-recognising"), X === !0 && Y === !1 && f() } function g() { _ && _.abort() } function w(e) { if (F("processResult"), X === !0 && Y === !1) { var n = e.results[e.results.length - 1][0].transcript; n && "" != n ? (n = x(n), c(n), F("processResult - recognised:" + n), ne === !0 ? m(n) : k(n) || (s(), S(n))) : F("processResult - nothing recognised:") } } function m(e) { e.trim() == ve.wakeWord && y() } function k(e) { return e.trim() == ve.sleepWord ? (b(), !0) : !1 } function b() { F("And Sleep - In Sleep Mode!"), M(j), ne = !0, s() } function y() { ne = !1, F("In full recognition mode - I am awake!"), L(j, !0, null), r() } function S(e) { if (I(e)) W(e); else if (ve.actions && ve.actions.length > 0) { for (var n = [], t = 0; t < ve.actions.length; t++) { var i = ve.actions[t]; i.contexturl && i.contexturl != pe || n.push(i) } if (n.length > 0) { for (var o = e.split(" "), c = [], a = e.replace(" ", ""), t = 0; t < n.length; t++) { var i = n[t]; if (i.phrases && i.phrases.length > 0) { for (var s = null != i.accuracypercentage ? i.accuracypercentage : ve.accuracyPercentage, l = 0, u = 0; u < i.phrases.length; u++) { for (var d = i.phrases[u].toLowerCase(), h = d.split(" "), f = 100 / h.length, p = 0, v = o.length; v > 0; v--) { var g = h.indexOf(o[v - 1]); g > -1 && (p += f, h.splice(g)) } var w = d.replace(" ", ""); w === a && (p = 100), p >= l && (l = p) } l > s - .1 && (i.contexturl && "" != i.contexturl && i.type && "click" == i.type && (l += 1), c.push({ highestAccuracy: l, index: t })) } } c.length > 0 && (c.reverse(), C(n[c[0].index])) } } r() } function I(e) { return e && e.length > 0 && null != he && null != fe && (e.startsWith("search site for ") || e.startsWith("search site ") || e.startsWith("search for ") || e.startsWith("site search for ") || e.startsWith("site search ")) } function W(e) { e = e.replace("search site for ", "").replace("search site ", "").replace("search for ", "").replace("site search for", "").replace("site search ", ""), he.val(e), fe.submit() } function x(e) { return e.replace("-", " ").replace(".", "").replace("'", "").toLowerCase() } function C(e) { if (e && e.type && e.intent) switch (e.type.toLowerCase()) { case "redirect": window.location.href = e.intent; break; case "click": if (0 == e.intent.indexOf(".")) { var n = document.getElementsByClassName(e.intent.replace(".", "")); n && n.length > 0 && n[0].click() } else if (0 == e.intent.indexOf("#")) { var t = document.getElementById(e.intent.replace("#", "")); t && t.click() } break; case "scrolldown": R(!0); break; case "scrollup": R(!1); break; case "pagetop": O(0); break; case "pagebottom": O(ie); break; case "back": window.history.back() } } function R(e) { var n = $(window).scrollTop(), t = 0; n >= 0 && (1 == e ? t = n + .8 * te : (t = n - .8 * te, 0 > t && (t = 0)), O(t)) } function O(e) { e >= 0 && oe.animate({ scrollTop: e }, 1e3) } function T(e) { e && (null != e.wakeword ? ve.wakeWord = e.wakeword : ve.wakeWord, null != e.sleepword ? ve.sleepWord = e.sleepword : ve.sleepWord, null != e.accuracypercentage ? ve.accuracyPercentage = e.accuracypercentage : ve.accuracyPercentage, null != e.actions ? ve.actions = e.actions : ve.actions, null != e.desktoponly ? ve.desktopOnly = e.desktoponly : ve.desktopOnly, null != e.vuictadismissalperiodindays ? ve.vuiCTADismissalPeriodInDays = e.vuictadismissalperiodindays : ve.vuiCTADismissalPeriodInDays, null != e.autoEnabled ? ve.autoEnabled = e.autoEnabled : ve.autoEnabled, null != e.theme ? ve.theme = e.theme : ve.theme, null != e.brand ? ve.brand = e.brand : ve.brand, null != e.siteSearchFieldId ? ve.siteSearchFieldId = e.siteSearchFieldId : ve.siteSearchFieldId, ve.autoEnabled === !0 && V(), null != ve.siteSearchFieldId && (he = $("#" + ve.siteSearchFieldId), he.length > 0 && (fe = he.closest("form")))) } function P() { F("speechRecognitionService.onStart"), p() } function E(e) { F("speechRecognitionService.onResult"), w(e) } function D() { F("speechRecognitionService.onEnd"), v() } function A(e) { F("speechRecognitionService.onError"), "not-allowed" == e.error && we() } function F(e) { ee === !0 && console.log(e) } function V() { var e = $("a"), n = $("button"), t = $("[data-vui-phrases]"), i = 0; e.length > 0 && e.each(function () { var e = $(this), n = e.text(); i += 1, B(n, i, e) }), n.length > 0 && n.each(function () { var e = $(this); i += 1, B(e.text(), i, e) }), t.length > 0 && t.each(function () { var e = $(this), n = e.data("vui-phrases"); i += 1, B(n, i, e) }) } function B(e, n, t) { if ("" != e && n > 0 && t) { e = e.trim(); var i = "vui-ae-" + n, o = e.split("|"), c = []; t.addClass(i); for (var a = 0; a < o.length; a++) { var r = o[a]; -1 == c.indexOf(r) && (c.push(r), r.startsWith("go to ") || c.push("go to " + r), r.startsWith("goto ") || c.push("goto " + r), r.startsWith("click ") || c.push("click " + r)) } ve.actions.push({ contexturl: pe, type: "click", phrases: c, intent: "." + i, accuracypercentage: ve.accuracyPercentage }) } } function L(e, n, t) { var i = ""; if (t) { var o = new Date; o.setTime(o.getTime() + 24 * t * 60 * 60 * 1e3), i = "expires=" + o.toUTCString() } document.cookie = e + "=" + n + ";" + i + ";path=/" } function U(e) { for (var n = e + "=", t = decodeURIComponent(document.cookie), i = t.split(";"), o = 0; o < i.length; o++) { for (var c = i[o]; " " == c.charAt(0) ;) c = c.substring(1); if (0 == c.indexOf(n)) return c.substring(n.length, c.length) } return "" } function M(e) { document.cookie = e + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;" } function q(e) { $.get("/vui/vooi.html", function (n) { $("body").append(n), $(".vui-cta--brand").text(ve.brand), $("#vui-information--wakeword").text(ve.wakeWord), $("#vui-information--sleepword").text(ve.sleepWord), oe = $("html, body"), ce = $("#vui-cta"), ae = $("#vui-cta .vui-cta--information"), re = $("#vui-controls"), se = $("#vui-controls .vui-speech-wrap"), le = $("#vui-controls .vui-equalizer"), ue = $("#vui-results"), de = $(".vui-mic-wrap"), l(), re.attr("title", "Vooi - Voice Control for websites. Say '" + ve.wakeWord + "' to wake me up, or '" + ve.sleepWord + "' to make me sleep"), e && e() }) } function z() { var e = "vui-theme-" + ve.theme; ce.addClass(e), re.addClass(e) } var G = "vuienabled", J = "vuidismissed", N = "vuimicblocked", j = "vuiawake", H = "true" == U(G), K = "true" == U(J), Q = !1, X = !1, Y = !1, Z = !1, _ = (/Mobi/.test(navigator.userAgent), null), ee = !1, ne = !0, te = $(window).height(), ie = $(document).height(), oe = null, ce = null, ae = null, re = null, se = null, le = null, ue = null, de = null, he = null, fe = null, pe = window.location.href.replace(window.location.origin, ""), ve = { brand: "this website", desktopOnly: !0, wakeWord: "help", sleepWord: "goodbye", vuiCTADismissalPeriodInDays: 0, accuracyPercentage: 50, actions: null, autoEnabled: !1, theme: "red", siteSearchFieldId: null }, ge = function (t) { if (Q = window.hasOwnProperty("webkitSpeechRecognition") || window.hasOwnProperty("SpeechRecognition"), T(t), o()) if (Q === !0 && H === !1 && K === !1) { var c = function () { z(), n() }; q(c) } else if (Q === !0 && H === !0) { var c = function () { z(), i(), "true" == U(j) ? y() : ne = !0, e() }; q(c) } }, we = function () { F("speechRecognitionService.stop"), X = !1, Y = !1, Z = !1, g() }, me = function () { F("speechRecognitionService.pause"), Y = !0, Z = !1, g() }; return { Init: function (e) { ge(e) }, Stop: we, Pause: me } }();